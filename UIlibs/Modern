local UILib = {}

-- Configurações padrão
local defaultSettings = {
    ThemeColor = Color3.fromRGB(0, 120, 215),
    TextColor = Color3.fromRGB(255, 255, 255),
    Font = Enum.Font.SourceSans,
    TextSize = 14,
    WindowSize = UDim2.new(0, 400, 0, 300),
    WindowPosition = UDim2.new(0.5, -200, 0.5, -150)
}

-- Função para criar uma nova janela
function UILib:CreateWindow(title, settings)
    -- Combinar configurações padrão com as personalizadas
    settings = settings or {}
    for k, v in pairs(defaultSettings) do
        if settings[k] == nil then
            settings[k] = v
        end
    end
    
    -- Criação dos elementos da UI
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "UILibWindow"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = settings.WindowSize
    mainFrame.Position = settings.WindowPosition
    mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    mainFrame.BorderSizePixel = 0
    mainFrame.ClipsDescendants = true
    mainFrame.Parent = screenGui
    
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.BackgroundColor3 = settings.ThemeColor
    titleBar.BorderSizePixel = 0
    titleBar.Parent = mainFrame
    
    local titleText = Instance.new("TextLabel")
    titleText.Name = "TitleText"
    titleText.Size = UDim2.new(1, -10, 1, 0)
    titleText.Position = UDim2.new(0, 10, 0, 0)
    titleText.BackgroundTransparency = 1
    titleText.Text = title or "Window"
    titleText.TextColor3 = settings.TextColor
    titleText.Font = settings.Font
    titleText.TextSize = settings.TextSize + 2
    titleText.TextXAlignment = Enum.TextXAlignment.Left
    titleText.Parent = titleBar
    
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 30, 1, 0)
    closeButton.Position = UDim2.new(1, -30, 0, 0)
    closeButton.BackgroundTransparency = 1
    closeButton.Text = "X"
    closeButton.TextColor3 = settings.TextColor
    closeButton.Font = settings.Font
    closeButton.TextSize = settings.TextSize + 2
    closeButton.Parent = titleBar
    
    local contentFrame = Instance.new("Frame")
    contentFrame.Name = "ContentFrame"
    contentFrame.Size = UDim2.new(1, 0, 1, -30)
    contentFrame.Position = UDim2.new(0, 0, 0, 30)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = mainFrame
    
    -- Adicionar funcionalidade de arrastar
    local dragging = false
    local dragInput, dragStart, startPos
    
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    titleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X, 
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- Fechar a janela
    closeButton.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)
    
    -- Métodos para a janela
    local windowMethods = {}
    
    function windowMethods:Destroy()
        screenGui:Destroy()
    end
    
    function windowMethods:ToggleVisibility()
        screenGui.Enabled = not screenGui.Enabled
    end
    
    function windowMethods:CreateButton(buttonName, callback)
        local button = Instance.new("TextButton")
        button.Name = buttonName or "Button"
        button.Size = UDim2.new(1, -20, 0, 30)
        button.Position = UDim2.new(0, 10, 0, #contentFrame:GetChildren() * 35 + 10)
        button.BackgroundColor3 = settings.ThemeColor
        button.TextColor3 = settings.TextColor
        button.Font = settings.Font
        button.TextSize = settings.TextSize
        button.Text = buttonName or "Button"
        button.Parent = contentFrame
        
        if callback then
            button.MouseButton1Click:Connect(callback)
        end
        
        return button
    end
    
    function windowMethods:CreateLabel(labelText)
        local label = Instance.new("TextLabel")
        label.Name = "Label"
        label.Size = UDim2.new(1, -20, 0, 20)
        label.Position = UDim2.new(0, 10, 0, #contentFrame:GetChildren() * 25 + 10)
        label.BackgroundTransparency = 1
        label.TextColor3 = settings.TextColor
        label.Font = settings.Font
        label.TextSize = settings.TextSize
        label.Text = labelText or "Label"
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = contentFrame
        
        return label
    end
    
    function windowMethods:CreateTextBox(placeholder)
        local textBox = Instance.new("TextBox")
        textBox.Name = "TextBox"
        textBox.Size = UDim2.new(1, -20, 0, 30)
        textBox.Position = UDim2.new(0, 10, 0, #contentFrame:GetChildren() * 35 + 10)
        textBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        textBox.TextColor3 = settings.TextColor
        textBox.Font = settings.Font
        textBox.TextSize = settings.TextSize
        textBox.PlaceholderText = placeholder or "Type here..."
        textBox.ClearTextOnFocus = false
        textBox.Parent = contentFrame
        
        return textBox
    end
    
    return windowMethods
end

return UILib
